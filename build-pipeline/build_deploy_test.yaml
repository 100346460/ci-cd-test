steps:
  - name: gcr.io/cloud-builders/git
    args: ['clone', 'https://github.com/100346460/ci-cd-test.git']
    id: 'check-out-source-code'
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t','us-central1-docker.pkg.dev/valid-hall-374418/ci-cd-dbt:latest', '.'] 
    dir: '$_REPO_NAME/dbt-source/dbt_project'
  - name: 'apache/airflow:slim-2.3.1-python3.7'
    entrypoint: 'python'
    args: ['test_basic_unittest.py']
    dir: '$_REPO_NAME/workflow-dag'
    env: ['PYTHONPATH=/home/airflow/.local/lib/python3.7/site-packages']
    id: 'execute-basic-unit-tests'
  - name: gcr.io/cloud-builders/gsutil
    args: ['cp', 'data-pipeline-dag-test.py', 'gs://us-central1-data-pipeline-c-754e65cf-bucket/dags']
    dir: '$_REPO_NAME/workflow-dag'
    id: 'deploy-processing-pipeline'
  - name: 'apache/airflow:slim-2.3.1-python3.7'
    entrypoint: 'python'
    args: ['wait_for_dag_deployed.py']
    dir: '$_REPO_NAME/build-pipeline'
    env: ['PYTHONPATH=/home/airflow/.local/lib/python3.7/site-packages']
    id: 'wait_for_dag_deployed'
  
images: [us-central1-docker.pkg.dev/valid-hall-374418/ci-cd-dbt:latest]  