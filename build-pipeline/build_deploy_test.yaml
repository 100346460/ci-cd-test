steps:
  - name: gcr.io/cloud-builders/git
    args: ['clone', 'https://source.developers.google.com/p/data-pipeline-interactive/r/ci-cd-test']
    id: 'check-out-source-code'
  - name: 'apache/airflow:slim-2.3.1-python3.7'
    entrypoint: 'python'
    args: ['test_basic_unittest.py']
    dir: '$_REPO_NAME/workflow-dag'
    env: ['PYTHONPATH=/home/airflow/.local/lib/python3.7/site-packages']
    id: 'execute-basic-unit-tests'
  - name: gcr.io/cloud-builders/gsutil
    args: ['cp', 'data-pipeline-dag-test.py', 'gs://us-central1-data-pipeline-c-754e65cf-bucket/dags']
    dir: '$_REPO_NAME/workflow-dag'
    id: 'deploy-processing-pipeline'
  - name: gcr.io/cloud-builders/gcloud
    entrypoint: 'bash'
    args: ['wait_for_dag_deployed.sh', '${_COMPOSER_ENV_NAME}', '${_COMPOSER_REGION}', '{$_COMPOSER_DAG_NAME_TEST}', '6', '20']
    dir: '$_REPO_NAME/build-pipeline'
    id: 'wait-for-dag-deployed-on-composer'
  